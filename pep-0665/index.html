
<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PEP 665 – Specifying Installation Requirements for Python Projects | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png"/>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/mq.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <meta name="description" content="Python Enhancement Proposals (PEPs)"/>
</head>
<body>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 665 – Specifying Installation Requirements for Python Projects</li>
            </ul>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 665 – Specifying Installation Requirements for Python Projects</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">PEP</dt>
<dd class="field-odd">665</dd>
<dt class="field-even">Title</dt>
<dd class="field-even">Specifying Installation Requirements for Python Projects</dd>
<dt class="field-odd">Author</dt>
<dd class="field-odd">Brett Cannon &lt;brett&#32;&#97;t&#32;python.org&gt;,
Pradyun Gedam &lt;pradyunsg&#32;&#97;t&#32;gmail.com&gt;,
Tzu-ping Chung &lt;uranusjr&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-even">PEP-Delegate</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Discussions-To</dt>
<dd class="field-odd"><a class="reference external" href="https://discuss.python.org/t/pep-665-specifying-installation-requirements-for-python-projects/9911">https://discuss.python.org/t/pep-665-specifying-installation-requirements-for-python-projects/9911</a></dd>
<dt class="field-even">Status</dt>
<dd class="field-even">Draft</dd>
<dt class="field-odd">Type</dt>
<dd class="field-odd">Standards Track</dd>
<dt class="field-even">Created</dt>
<dd class="field-even">29-Jul-2021</dd>
<dt class="field-odd">Post-History</dt>
<dd class="field-odd">29-Jul-2021</dd>
<dt class="field-even">Resolution</dt>
<dd class="field-even"><p></p></dd>
</dl>
<hr class="docutils" />
<section id="contents">
<h2>Contents</h2>
<ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a><ul>
<li><a class="reference internal" href="#providers">Providers</a><ul>
<li><a class="reference internal" href="#platform-infrastructure-providers">Platform/Infrastructure Providers</a></li>
<li><a class="reference internal" href="#ide-providers">IDE Providers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#developers">Developers</a><ul>
<li><a class="reference internal" href="#developers-using-paas-iaas-providers">Developers using PaaS &amp; IaaS providers</a></li>
<li><a class="reference internal" href="#developers-using-ides">Developers using IDEs</a></li>
<li><a class="reference internal" href="#developers-working-with-other-developers">Developers working with other developers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upgraders-package-infrastructure-providers">Upgraders &amp; Package Infrastructure Providers</a></li>
<li><a class="reference internal" href="#open-source-community">Open Source Community</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rationale">Rationale</a><ul>
<li><a class="reference internal" href="#goals">Goals</a></li>
<li><a class="reference internal" href="#non-goals">Non-Goals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#details">Details</a><ul>
<li><a class="reference internal" href="#version"><code class="docutils literal notranslate"><span class="pre">version</span></code></a></li>
<li><a class="reference internal" href="#tool"><code class="docutils literal notranslate"><span class="pre">[tool]</span></code></a></li>
<li><a class="reference internal" href="#metadata"><code class="docutils literal notranslate"><span class="pre">[metadata]</span></code></a><ul>
<li><a class="reference internal" href="#metadata-marker"><code class="docutils literal notranslate"><span class="pre">metadata.marker</span></code></a></li>
<li><a class="reference internal" href="#metadata-tags"><code class="docutils literal notranslate"><span class="pre">metadata.tags</span></code></a></li>
<li><a class="reference internal" href="#metadata-needs"><code class="docutils literal notranslate"><span class="pre">metadata.needs</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#package"><code class="docutils literal notranslate"><span class="pre">[package]</span></code></a><ul>
<li><a class="reference internal" href="#package-name-version"><code class="docutils literal notranslate"><span class="pre">package.&lt;name&gt;.version</span></code></a></li>
<li><a class="reference internal" href="#package-name-needs"><code class="docutils literal notranslate"><span class="pre">package.&lt;name&gt;.needs</span></code></a></li>
<li><a class="reference internal" href="#package-name-needed-by"><code class="docutils literal notranslate"><span class="pre">package.&lt;name&gt;.needed-by</span></code></a></li>
<li><a class="reference internal" href="#package-name-code"><code class="docutils literal notranslate"><span class="pre">package.&lt;name&gt;.code</span></code></a><ul>
<li><a class="reference internal" href="#type-wheel"><code class="docutils literal notranslate"><span class="pre">type=&quot;wheel&quot;</span></code></a></li>
<li><a class="reference internal" href="#type-sdist"><code class="docutils literal notranslate"><span class="pre">type=&quot;sdist&quot;</span></code></a></li>
<li><a class="reference internal" href="#type-git"><code class="docutils literal notranslate"><span class="pre">type=&quot;git&quot;</span></code></a></li>
<li><a class="reference internal" href="#type-source-tree"><code class="docutils literal notranslate"><span class="pre">type=&quot;source</span> <span class="pre">tree&quot;</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#installer-expectations">Installer Expectations</a><ul>
<li><a class="reference internal" href="#example-flow">Example Flow</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#file-formats-other-than-toml">File Formats Other Than TOML</a></li>
<li><a class="reference internal" href="#alternative-name-to-pyproject-lock-d">Alternative Name to <code class="docutils literal notranslate"><span class="pre">pyproject-lock.d</span></code></a></li>
<li><a class="reference internal" href="#supporting-a-single-lock-file">Supporting a Single Lock File</a></li>
<li><a class="reference internal" href="#using-a-flat-list-instead-of-a-dependency-graph">Using a Flat List Instead of a Dependency Graph</a></li>
<li><a class="reference internal" href="#being-concerned-about-different-dependencies-per-wheel-file-for-a-project">Being Concerned About Different Dependencies Per Wheel File For a Project</a></li>
<li><a class="reference internal" href="#use-wheel-tags-in-the-file-name">Use Wheel Tags in the File Name</a></li>
<li><a class="reference internal" href="#using-semantic-versioning-for-version">Using Semantic Versioning for <code class="docutils literal notranslate"><span class="pre">version</span></code></a></li>
<li><a class="reference internal" href="#alternative-names-for-needs">Alternative Names for <code class="docutils literal notranslate"><span class="pre">needs</span></code></a></li>
<li><a class="reference internal" href="#alternative-names-for-needed-by">Alternative Names for <code class="docutils literal notranslate"><span class="pre">needed-by</span></code></a></li>
<li><a class="reference internal" href="#only-allowing-a-single-code-location-for-a-project">Only Allowing a Single Code Location For a Project</a></li>
<li><a class="reference internal" href="#support-for-branches-and-tags-for-git">Support for Branches and Tags for Git</a></li>
<li><a class="reference internal" href="#accepting-pep-650">Accepting PEP 650</a></li>
</ul>
</li>
<li><a class="reference internal" href="#open-issues">Open Issues</a><ul>
<li><a class="reference internal" href="#allow-for-tool-specific-type-values">Allow for Tool-Specific <code class="docutils literal notranslate"><span class="pre">type</span></code> Values</a></li>
<li><a class="reference internal" href="#support-variable-expansion-in-the-url-field">Support Variable Expansion in the <code class="docutils literal notranslate"><span class="pre">url</span></code> field</a></li>
<li><a class="reference internal" href="#don-t-require-lock-files-be-in-a-pyproject-lock-d-directory">Don’t Require Lock Files Be in a <code class="docutils literal notranslate"><span class="pre">pyproject-lock.d</span></code> directory</a></li>
<li><a class="reference internal" href="#record-the-date-of-when-the-lock-file-was-generated">Record the Date of When the Lock File was Generated</a></li>
<li><a class="reference internal" href="#locking-build-dependencies">Locking Build Dependencies</a></li>
<li><a class="reference internal" href="#recording-the-requires-dist-input-to-the-locker-s-resolver">Recording the <code class="docutils literal notranslate"><span class="pre">Requires-Dist</span></code> Input to the Locker’s Resolver</a></li>
<li><a class="reference internal" href="#providing-marker-and-tags-per-package">Providing <code class="docutils literal notranslate"><span class="pre">marker</span></code> and <code class="docutils literal notranslate"><span class="pre">tags</span></code> per Package</a></li>
</ul>
</li>
<li><a class="reference internal" href="#acknowledgments">Acknowledgments</a></li>
<li><a class="reference internal" href="#id1">References</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract">Abstract</a></h2>
<p>This PEP specifies a file format to list the Python package
installation requirements for a project. The list of projects is
considered exhaustive for the installation target and thus
<em>locked down</em>, not requiring any information beyond the platform being
installed for and the <em>lock file</em> listing the required dependencies
to perform a successful installation of dependencies.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation">Motivation</a></h2>
<p>Thanks to <a class="reference external" href="../pep-0621">PEP 621</a>, projects have a way to list their direct/top-level
dependencies which they need to have installed. But <a class="reference external" href="../pep-0621">PEP 621</a> also
(purposefully) omits two key details that often become important for
projects:</p>
<ol class="arabic simple">
<li>A listing of all indirect/transitive dependencies</li>
<li>Specifying (at least) specific versions of dependencies for
reproducible installations</li>
</ol>
<p>Both needs can be important for various reasons when creating a new
environment. Consider a project which
is an application that is deployed somewhere (either to users as a
desktop app or to a server). Without a complete listing of all
dependencies and the specific versions to use, there can be a skew
between developers of the same project, or developer and user, based on
what versions of a project’s dependencies happen to be available at the
time of installation in a new environment. For instance, a dependency may
have v1 as the newest version on Monday when one developer installed the
dependency, while v2 comes out on Wednesday when another developer
installs the same dependency. Now the two developers are working against
two different versions of the same dependency, which can lead to different
outcomes. This is the use-case of developing a desktop or server
application where one might have a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file which
specifies exact versions of various packages.</p>
<p>Another important reason for reproducible installations is for
security purposes. Guaranteeing that the same binary data is
downloaded and installed for all installations of an app makes sure that no
bad actor has somehow changed a dependency’s binary data in a malicious
way. A lock file can assist in this guarantee by recording the exact
details of what should be installed and how to verify that those
dependencies have not changed any bytes unexpectedly. This is the use-case
of developing a secure application using a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file which
specifies the hash of all the packages that should be installed.</p>
<p>Tied into this concept of reproducibility is the speed at which an
environment can be recreated. If you created a lock file as part of
your local development, it can be used to speed up recreating that
development environment by minimizing having to query the network or the
scope of the possible resolution of dependencies. This makes recreating
your local development environment faster as the amount of work required
to calculate what dependencies to install has been minimized. This is the
use-case of when you are working on a library or some such project where
the lock file is not committed to version control and the lock file used as
a local cache of installation resolution details, such as an uncommitted
<code class="docutils literal notranslate"><span class="pre">poetry.lock</span></code> file.</p>
<p>The community itself has also shown a need for lock files based on the
fact that multiple tools have independently created their own lock
file formats:</p>
<ol class="arabic simple">
<li><a class="reference external" href="https://pypi.org/project/pdm/">PDM</a> <a class="footnote-reference brackets" href="#id23" id="id24">10</a></li>
<li><a class="reference external" href="https://pypi.org/project/pip-tools/">pip-tools</a> <a class="footnote-reference brackets" href="#id27" id="id28">11</a></li>
<li><a class="reference external" href="https://pypi.org/project/pipenv/">Pipenv</a> <a class="footnote-reference brackets" href="#id29" id="id30">12</a></li>
<li><a class="reference external" href="https://pypi.org/project/poetry/">Poetry</a> <a class="footnote-reference brackets" href="#id40" id="id41">14</a></li>
<li><a class="reference external" href="https://pypi.org/project/pyflow/">Pyflow</a> <a class="footnote-reference brackets" href="#id45" id="id46">15</a></li>
</ol>
<p>Other programming language communities have also shown the usefulness
of lock files by developing their own solution to this problem. Some
of those communities include:</p>
<ol class="arabic simple">
<li><a class="reference external" href="https://dart.dev/">Dart</a> <a class="footnote-reference brackets" href="#id6" id="id7">3</a></li>
<li><a class="reference external" href="https://www.npmjs.com/">npm</a> <a class="footnote-reference brackets" href="#id21" id="id22">9</a>/Node</li>
<li><a class="reference external" href="https://www.rust-lang.org/">Rust</a> <a class="footnote-reference brackets" href="#id49" id="id50">17</a></li>
</ol>
<p>Below, we identify some use-cases applicable to stakeholders in the
Python community and anyone who interacts with Python package
installers who are the ultimate consumers of a lock file (this is not
considered exhaustive and is borrowed from <a class="reference external" href="../pep-0650">PEP 650</a>).</p>
<section id="providers">
<h3><a class="toc-backref" href="#providers">Providers</a></h3>
<p>Providers are the parties (organization, person, community, etc.) that
supply a service or software tool which interacts with Python
packaging. Two different types of providers are considered:</p>
<section id="platform-infrastructure-providers">
<h4><a class="toc-backref" href="#platform-infrastructure-providers">Platform/Infrastructure Providers</a></h4>
<p>Platform providers (cloud environments, application hosting, etc.) and
infrastructure service providers need to support package installers
for their users to install Python dependencies. Most only support
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> files and a smattering of other file formats for
listing a project’s dependencies. Most providers do not want to maintain
support for more than one dependency specification format
because of the complexity it adds to their software or service and the
resources it takes to do so (e.g. not all platform providers have
the staffing to support pip-tools, Poetry, Pipenv, etc.).</p>
<p>This PEP would allow platform providers to declare support for this PEP
and thus only have to support one dependency specification format. What
this would mean is developers could use whatever toolchain they preferred
for development as long as they could emit a file that implemented this
PEP. This then allows developers to not have to align with what their
platform providers supports as long as everyone agrees to implementing
this PEP.</p>
</section>
<section id="ide-providers">
<h4><a class="toc-backref" href="#ide-providers">IDE Providers</a></h4>
<p>Integrated development environments may interact with Python package
installation and management. Most only support select few tools, and
users are required to find work arounds to install
their dependencies using other package installers. Similar to the
situation with PaaS &amp; IaaS providers, IDE providers do not want to
maintain support for N different formats. Instead, tools would only
need to be able to read files which implement this PEP to perform various
actions (e.g. list all the dependencies of the open project, which ones
are missing, install dependencies, generate the lock file, etc.).</p>
<p>As an example, the Python extension for VS Code has to have custom support
for each installer tool people may use: pip, Poetry, Pipenv, etc. This is
not only tedious by having to track multiple projects and any changes they
make, but it also locks out newer tools whose popularity isn’t great
enough to warrant inclusion in the extension.</p>
</section>
</section>
<section id="developers">
<h3><a class="toc-backref" href="#developers">Developers</a></h3>
<p>Developers are teams, people, or communities that code and use Python
package installers and Python packages. Three different types of
developers are considered:</p>
<section id="developers-using-paas-iaas-providers">
<h4><a class="toc-backref" href="#developers-using-paas-iaas-providers">Developers using PaaS &amp; IaaS providers</a></h4>
<p>Most PaaS and IaaS providers only support one Python package
installer: <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>. This dictates the installers that
developers can use while working with these providers, which might not
be optimal for their application or workflow.</p>
<p>Developers adopting this PEP would be able to use third party
platforms/infrastructure without having to
worry about which Python package installer they are required to use as
long as the provider also supports this PEP.</p>
</section>
<section id="developers-using-ides">
<h4><a class="toc-backref" href="#developers-using-ides">Developers using IDEs</a></h4>
<p>Most IDEs only support pip or a few Python package installers.
Consequently, developers must use workarounds or hacky methods to
install their dependencies if they use an unsupported package
installer.</p>
<p>If the IDE uses/supports this PEP it would allow for
any developer to use whatever tooling they wanted to generate
their lock file while the IDE can use whatever tooling it wants to
performs actions with/on the lock file.</p>
</section>
<section id="developers-working-with-other-developers">
<h4><a class="toc-backref" href="#developers-working-with-other-developers">Developers working with other developers</a></h4>
<p>Developers want to be able to use the installer of their choice while
working with other developers, but currently have to synchronize their
installer choice for compatibility of dependency installation. If all
preferred installers instead implemented the specified interface, it
would allow for cross use of installers, allowing developers to choose
an installer regardless of their collaborator’s preference.</p>
</section>
</section>
<section id="upgraders-package-infrastructure-providers">
<h3><a class="toc-backref" href="#upgraders-package-infrastructure-providers">Upgraders &amp; Package Infrastructure Providers</a></h3>
<p>Package upgraders and package infrastructure in CI/CD such as
<a class="reference external" href="https://dependabot.com/">Dependabot</a> <a class="footnote-reference brackets" href="#id8" id="id9">4</a>, <a class="reference external" href="https://pyup.io/">PyUP</a> <a class="footnote-reference brackets" href="#id47" id="id48">16</a>, etc. currently support a few formats. They work
by parsing and editing the dependency files with
relevant package information such as upgrades, downgrades, or new
hashes. Similar to Platform and IDE providers, most of these providers
do not want to support N different formats.</p>
<p>Currently, these services/bots have to implement support for each
format individually. Inevitably, the most popular
formats are supported first, and less popular tools are often never
supported. By implementing this specification, these services/bots can
support one format, allowing users to select the tool
of their choice to generate the file. This will allow for more innovation
in the space, as platforms and IDEs are no longer forced to prematurely
select a “winner” tool which generates a lock file.</p>
</section>
<section id="open-source-community">
<h3><a class="toc-backref" href="#open-source-community">Open Source Community</a></h3>
<p>Specifying installer requirements and adopting this PEP will reduce
the friction between Python package installers and people’s workflows.
Consequently, it will reduce the friction between Python package
installers and 3rd party infrastructure/technologies such as PaaS or
IDEs. Overall, it will allow for easier development, deployment and
maintenance of Python projects as Python package installation becomes
simpler and more interoperable.</p>
<p>Specifying a single file format can also increase the pace of innovation
around installers and the generation of dependency graphs. By
decoupling generating the dependency graph details from installation It
allows for each area to grow and innovate independently. It also allows
more flexibility in tool selection on either end of the dependency graph
and installation ends of this process.</p>
</section>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale">Rationale</a></h2>
<p>To begin, two key terms should be defined. A <strong>locker</strong> is a tool
which <em>produces</em> a lock file. An <strong>installer</strong> is a tool which
<em>consumes</em> a lock file to install the appropriate dependencies.</p>
<p>The expected information flow to occur if this PEP were accepted, from
the specification of top-level dependencies to all necessary
dependencies being installed in a fresh environment, is:</p>
<ol class="arabic simple">
<li>Read top-level dependencies from <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> (<a class="reference external" href="../pep-0621">PEP 621</a>).</li>
<li>Generate a lock file via a locker in <code class="docutils literal notranslate"><span class="pre">pyproject-lock.d/</span></code>.</li>
<li>Install the appropriate dependencies based entirely on information
contained in the lock file via an installer.</li>
</ol>
<section id="goals">
<h3><a class="toc-backref" href="#goals">Goals</a></h3>
<p>The file format should be <em>machine-readable</em>, <em>machine-writable</em>, and
<em>human-readable</em>. Since the assumption is the vast majority of lock
file will be generated by a locker tool, the format should be easy
to write by a locker. As install tools will be consuming the lock
file, the format also needs to be easily read by an installer. But the
format should also be readable by a person as people will inevitably
be performing audits on lock files. Having a format that does not lend
itself towards being read by people would hinder that. This includes
changes to a lock file being readable in a diff format for auditing
changes. It also means that understanding <em>why</em> something is in
the lock file should be comprehensible in a diff to assist in auditing
changes.</p>
<p>The lock file format needs to be general enough to support
<em>cross-platform and cross-environment</em> specifications of dependencies.
This allows having a single lock file which can work on a myriad of
platforms and environments when that makes sense. This has been shown
as a necessary feature by the various tools in the Python packaging
ecosystem which already have a lock file format (e.g. <a class="reference external" href="https://pypi.org/project/pipenv/">Pipenv</a> <a class="footnote-reference brackets" href="#id29" id="id31">12</a>,
<a class="reference external" href="https://pypi.org/project/poetry/">Poetry</a> <a class="footnote-reference brackets" href="#id40" id="id42">14</a>, <a class="reference external" href="https://pypi.org/project/pdm/">PDM</a> <a class="footnote-reference brackets" href="#id23" id="id25">10</a>). This can be accomplished by <em>allowing</em> (but <strong>not</strong>
requiring) lockers to defer marker evaluation to the installer, and
thus permitting the locker to include a wider range of <em>possible</em>
dependencies that the installer has to work with.</p>
<p>The lock file also needs to support <em>reproducible installations</em>. If
one wants to restrict what the lock file covers to a single platform
to guarantee the exact dependencies and files which will be installed,
that should be doable. This can be critical in security contexts for
projects like <a class="reference external" href="https://securedrop.org/">SecureDrop</a> <a class="footnote-reference brackets" href="#id51" id="id52">18</a>.</p>
<p>When a computation could be performed either in the locker or
installer, the preference is to <em>perform the computation in the
locker</em>. This is because the assumption is a locker will be executed
less frequently than an installer.</p>
<p>The installer should be able to resolve what to install based entirely
on platform/environment information and what is contained within the
lock file. There should be
<em>no need to use network or other file system I/O</em> in order to resolve
what to install.</p>
<p>The lock file should provide enough flexibility to allow lockers and
installers to innovate. While the lock file specification provides a
<em>common denominator of functionality</em>, it should not act as a ceiling
for functionality.</p>
</section>
<section id="non-goals">
<h3><a class="toc-backref" href="#non-goals">Non-Goals</a></h3>
<p>Because of the expected size of lock files, no effort was put into
making lock files <em>human-writable</em>.</p>
<p>This PEP makes no attempt to make this work in any special way for
installers to use a lock file to install into a <em>preexisting</em> environment.
The assumption is the installer is installing into a <em>new/fresh</em>
environment.</p>
</section>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification">Specification</a></h2>
<section id="details">
<h3><a class="toc-backref" href="#details">Details</a></h3>
<p>Lock files MUST use the <a class="reference external" href="https://toml.io">TOML</a> <a class="footnote-reference brackets" href="#id60" id="id61">21</a> file format thanks to its adoption by
<a class="reference external" href="../pep-0518">PEP 518</a> for <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>. This not only prevents the need to
have another file format in the Python packaging ecosystem, but it
also assists in making lock files human-readable.</p>
<p>Lock files MUST be kept in a directory named <code class="docutils literal notranslate"><span class="pre">pyproject-lock.d</span></code>.
Lock files MUST end with a <code class="docutils literal notranslate"><span class="pre">.toml</span></code> file extension. Projects may have
as many lock files as they want using whatever file name stems they
choose. This PEP prescribes no specific way to automatically select
between multiple lock files and installers SHOULD avoid guessing which
lock file is “best-fitting” (this does not preclude situations where
only a single lock file with a certain name is expected to exist and
will be used by default, e.g. a documentation hosting site always
using a lock file named <code class="docutils literal notranslate"><span class="pre">pyproject-lock.d/rftd.toml</span></code> when provided).</p>
<p>The following are the top-level keys of the TOML file data format.</p>
<section id="version">
<h4><a class="toc-backref" href="#version"><code class="docutils literal notranslate"><span class="pre">version</span></code></a></h4>
<p>The version of the lock file being used. The key MUST be specified and
it MUST be set to <code class="docutils literal notranslate"><span class="pre">1</span></code>. The number MUST always be an integer and it
MUST only increment in future updates to the specification. What
consistitutes a version number increase is left to future PEPs or
standards changes.</p>
<p>Tools reading a lock file whose version they don’t support MUST raise
an error.</p>
</section>
<section id="tool">
<h4><a class="toc-backref" href="#tool"><code class="docutils literal notranslate"><span class="pre">[tool]</span></code></a></h4>
<p>Tools may create their own sub-tables under the <code class="docutils literal notranslate"><span class="pre">tool</span></code> table. The
rules for this table match those for <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> and its
<code class="docutils literal notranslate"><span class="pre">[tool]</span></code> table from the <a class="reference external" href="https://packaging.python.org/specifications/declaring-build-dependencies/">build system declaration spec</a> <a class="footnote-reference brackets" href="#id2" id="id3">1</a>.</p>
</section>
<section id="metadata">
<h4><a class="toc-backref" href="#metadata"><code class="docutils literal notranslate"><span class="pre">[metadata]</span></code></a></h4>
<p>A table containing data applying to the overall lock file.</p>
<section id="metadata-marker">
<h5><a class="toc-backref" href="#metadata-marker"><code class="docutils literal notranslate"><span class="pre">metadata.marker</span></code></a></h5>
<p>An optional key storing a string containing an environment marker as
specified in the <a class="reference external" href="https://packaging.python.org/specifications/dependency-specifiers/">dependency specifier spec</a> <a class="footnote-reference brackets" href="#id10" id="id11">5</a>.</p>
<p>The locker MAY specify an environment marker which specifies any
restrictions the lock file was generated under (e.g. specific Python
versions supported).</p>
<p>If the installer is installing for an environment which does not
satisfy the specified environment marker, the installer MUST raise an
error as the lock file does not support the environment.</p>
</section>
<section id="metadata-tags">
<h5><a class="toc-backref" href="#metadata-tags"><code class="docutils literal notranslate"><span class="pre">metadata.tags</span></code></a></h5>
<p>An optional array of inline tables representing
<a class="reference external" href="https://packaging.python.org/specifications/platform-compatibility-tags/">platform compatibility tags</a> <a class="footnote-reference brackets" href="#id33" id="id34">13</a> that the lock file supports. The locker
MAY specify tables in the array which represent the compatibility the
lock file was generated for.</p>
<p>The tables have the possible keys of:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">interpreter</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">abi</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">platform</span></code></li>
</ul>
<p>representing the parts of the platform compatibility tags. Each key is
optional in a table. These keys MUST represent a single value, i.e.
the values are exploded and not compressed in wheel tag parlance.</p>
<p>If the environment an installer is installing for does not match
<strong>any</strong> table in the array (missing keys in the table means implicit
support for that part of the compatibility), the installer MUST raise
an error as the lock file does not support the environment.</p>
</section>
<section id="metadata-needs">
<h5><a class="toc-backref" href="#metadata-needs"><code class="docutils literal notranslate"><span class="pre">metadata.needs</span></code></a></h5>
<p>An array of strings representing the package specifiers for the
top-level/direct dependencies of the lock file as defined by the
<a class="reference external" href="https://packaging.python.org/specifications/dependency-specifiers/">dependency specifier spec</a> <a class="footnote-reference brackets" href="#id10" id="id12">5</a> (i.e. the root of the dependency graph
for the lock file).</p>
<p>Lockers MUST only allow specifiers which may be satisfiable by the
lock file and the dependency graph the lock file encodes. Lockers MUST
normalize project names according to the <a class="reference external" href="https://packaging.python.org/specifications/simple-repository-api/">simple repository API</a> <a class="footnote-reference brackets" href="#id53" id="id54">19</a>.</p>
</section>
</section>
<section id="package">
<h4><a class="toc-backref" href="#package"><code class="docutils literal notranslate"><span class="pre">[package]</span></code></a></h4>
<p>A table containing arrays of tables for each dependency recorded
in the lock file.</p>
<p>Each key of the table is the name of a package which MUST be
normalized according to the <a class="reference external" href="https://packaging.python.org/specifications/simple-repository-api/">simple repository API</a> <a class="footnote-reference brackets" href="#id53" id="id55">19</a>. If extras are
specified as part of the project to install, the extras are to be
included in the key name and are to be sorted in lexicographic order.</p>
<p>Within the file, the tables for the projects MUST be
sorted by:</p>
<ol class="arabic simple">
<li>Project/key name in lexicographic order</li>
<li>Package version, newest/highest to older/lowest according to the
<a class="reference external" href="https://packaging.python.org/specifications/version-specifiers/">version specifiers spec</a> <a class="footnote-reference brackets" href="#id62" id="id63">22</a></li>
<li>Extras via lexicographic order</li>
</ol>
<section id="package-name-version">
<h5><a class="toc-backref" href="#package-name-version"><code class="docutils literal notranslate"><span class="pre">package.&lt;name&gt;.version</span></code></a></h5>
<p>A required string of the version of the package as specified by the
<a class="reference external" href="https://packaging.python.org/specifications/version-specifiers/">version specifiers spec</a> <a class="footnote-reference brackets" href="#id62" id="id64">22</a>.</p>
</section>
<section id="package-name-needs">
<h5><a class="toc-backref" href="#package-name-needs"><code class="docutils literal notranslate"><span class="pre">package.&lt;name&gt;.needs</span></code></a></h5>
<p>An optional key containing an array of strings following the
<a class="reference external" href="https://packaging.python.org/specifications/dependency-specifiers/">dependency specifier spec</a> <a class="footnote-reference brackets" href="#id10" id="id13">5</a> which specify what other packages this
package depends on. See <code class="docutils literal notranslate"><span class="pre">metadata.needs</span></code> for full details.</p>
</section>
<section id="package-name-needed-by">
<h5><a class="toc-backref" href="#package-name-needed-by"><code class="docutils literal notranslate"><span class="pre">package.&lt;name&gt;.needed-by</span></code></a></h5>
<p>A key containing an array of package names which depend on this
package. The package names MUST match the package name as used in the
<code class="docutils literal notranslate"><span class="pre">package</span></code> table.</p>
<p>The lack of a <code class="docutils literal notranslate"><span class="pre">needed-by</span></code> key infers that the package is a
top-level package listed in <code class="docutils literal notranslate"><span class="pre">metadata.needs</span></code>.</p>
</section>
<section id="package-name-code">
<h5><a class="toc-backref" href="#package-name-code"><code class="docutils literal notranslate"><span class="pre">package.&lt;name&gt;.code</span></code></a></h5>
<p>An array of tables listing files that are available to satisfy
the installation of the package for the specified version in the
<code class="docutils literal notranslate"><span class="pre">version</span></code> key.</p>
<p>Each table has a <code class="docutils literal notranslate"><span class="pre">type</span></code> key which specifies how the code is stored.
All other keys in the table are dependent on the value set for
<code class="docutils literal notranslate"><span class="pre">type</span></code>. The acceptable values for <code class="docutils literal notranslate"><span class="pre">type</span></code> are listed below; all
other possible values are reserved for future use.</p>
<p>Tables in the array MUST be sorted in lexicographic order of the value
of <code class="docutils literal notranslate"><span class="pre">type</span></code>, then lexicographic order for the value of <code class="docutils literal notranslate"><span class="pre">url</span></code>.</p>
<p>When recording a table, the fields SHOULD be listed in the order
the fields are listed in this specification for consistency to make
diffs of a lock file easier to read.</p>
<p>For all types other than “wheel”, an INSTALLER MAY refuse to install
code to avoid arbitrary code execution during installation.</p>
<p>An installer MUST verify the hash of any specified file.</p>
<section id="type-wheel">
<h6><a class="toc-backref" href="#type-wheel"><code class="docutils literal notranslate"><span class="pre">type=&quot;wheel&quot;</span></code></a></h6>
<p>A <a class="reference external" href="https://packaging.python.org/specifications/binary-distribution-format/">wheel file</a> <a class="footnote-reference brackets" href="#id65" id="id66">23</a> for the package version.</p>
<p>Supported keys in the table are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">url</span></code>: a string of location of the wheel file (use the
<code class="docutils literal notranslate"><span class="pre">file:</span></code> protocol for the local file system)</li>
<li><code class="docutils literal notranslate"><span class="pre">hash-algorithm</span></code>: a string of the algorithm used to generate the
hash value stored in <code class="docutils literal notranslate"><span class="pre">hash-value</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">hash-value</span></code>: a string of the hash of the file contents</li>
<li><code class="docutils literal notranslate"><span class="pre">interpreter-tag</span></code>: (optional) a string of the interpreter portion
of the wheel tag as specified by the <a class="reference external" href="https://packaging.python.org/specifications/platform-compatibility-tags/">platform compatibility tags</a> <a class="footnote-reference brackets" href="#id33" id="id35">13</a>
spec</li>
<li><code class="docutils literal notranslate"><span class="pre">abi-tag</span></code>: (optional) a string of the ABI portion of the wheel tag
as specified by the <a class="reference external" href="https://packaging.python.org/specifications/platform-compatibility-tags/">platform compatibility tags</a> <a class="footnote-reference brackets" href="#id33" id="id36">13</a> spec</li>
<li><code class="docutils literal notranslate"><span class="pre">platform-tag</span></code>: (optional) a string of the platform portion of the
wheel tag as specified by the <a class="reference external" href="https://packaging.python.org/specifications/platform-compatibility-tags/">platform compatibility tags</a> <a class="footnote-reference brackets" href="#id33" id="id37">13</a> spec</li>
</ul>
<p>If the keys related to <a class="reference external" href="https://packaging.python.org/specifications/platform-compatibility-tags/">platform compatibility tags</a> <a class="footnote-reference brackets" href="#id33" id="id38">13</a> are absent then
the installer MUST infer the tags from the URL’s file name. If any of
the <a class="reference external" href="https://packaging.python.org/specifications/platform-compatibility-tags/">platform compatibility tags</a> <a class="footnote-reference brackets" href="#id33" id="id39">13</a> are specified by a key in the table
then a locker MUST provide all three related keys. The values of the
keys may be compressed tags.</p>
</section>
<section id="type-sdist">
<h6><a class="toc-backref" href="#type-sdist"><code class="docutils literal notranslate"><span class="pre">type=&quot;sdist&quot;</span></code></a></h6>
<p>A <a class="reference external" href="https://packaging.python.org/specifications/source-distribution-format/">source distribution file</a> <a class="footnote-reference brackets" href="#id56" id="id57">20</a> (sdist) for the package version.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">url</span></code>: a string of location of the sdist file (use the
<code class="docutils literal notranslate"><span class="pre">file:</span></code> protocol for the local file system)</li>
<li><code class="docutils literal notranslate"><span class="pre">hash-algorithm</span></code>: a string of the algorithm used to generate the
hash value stored in <code class="docutils literal notranslate"><span class="pre">hash-value</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">hash-value</span></code>: a string of the hash of the file contents</li>
</ul>
</section>
<section id="type-git">
<h6><a class="toc-backref" href="#type-git"><code class="docutils literal notranslate"><span class="pre">type=&quot;git&quot;</span></code></a></h6>
<p>A <a class="reference external" href="https://git-scm.com/">Git</a> <a class="footnote-reference brackets" href="#id17" id="id18">7</a> version control repository for the package.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">url</span></code>: a string of location of the repository (use the
<code class="docutils literal notranslate"><span class="pre">file:</span></code> protocol for the local file system)</li>
<li><code class="docutils literal notranslate"><span class="pre">commit</span></code>: a string of the commit of the repository which
represents the version of the package</li>
</ul>
<p>The repository MUST follow the <a class="reference external" href="https://packaging.python.org/specifications/source-distribution-format/">source distribution file</a> <a class="footnote-reference brackets" href="#id56" id="id58">20</a> spec
for source trees, otherwise an error is to be raised by the locker.</p>
<p>As the commit ID for a Git repository is a hash of the repository’s
contents, there is no hash to verify.</p>
</section>
<section id="type-source-tree">
<h6><a class="toc-backref" href="#type-source-tree"><code class="docutils literal notranslate"><span class="pre">type=&quot;source</span> <span class="pre">tree&quot;</span></code></a></h6>
<p>A source tree which can be used to build a wheel.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">url</span></code>: a string of location of the source tree (use the
<code class="docutils literal notranslate"><span class="pre">file:</span></code> protocol for the local file system)</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mime-type</span></code>: (optional) a string representing the MIME type of the</dt><dd>URL</dd>
</dl>
</li>
<li><code class="docutils literal notranslate"><span class="pre">hash-algorithm</span></code>: (optional for a local directory) a string of the
algorithm used to generate the hash value stored in <code class="docutils literal notranslate"><span class="pre">hash-value</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">hash-value</span></code>: (optional for a local directory) a string of the
hash of the file contents</li>
</ul>
<p>The collection of files MUST follow the <a class="reference external" href="https://packaging.python.org/specifications/source-distribution-format/">source distribution file</a> <a class="footnote-reference brackets" href="#id56" id="id59">20</a>
spec for source trees, otherwise an error is to be raised by the
locker.</p>
<p>Installers MAY use the file extension, MIME type from HTTP headers,
etc. to infer whether they support the storage mechanism used for the
source tree. If the MIME type cannot be inferred and it is not
specified via <code class="docutils literal notranslate"><span class="pre">mime-type</span></code> then an error MUST be raised.</p>
<p>If the source tree is NOT a local directory, then an installer MUST
verify the hash value. Otherwise if the source tree is a local
directory then the <code class="docutils literal notranslate"><span class="pre">hash-algorithm</span></code> and <code class="docutils literal notranslate"><span class="pre">hash-value</span></code> keys MUST be
left out. The installer MAY warn the user of the use of a local
directory due to the potential change in code since the lock file
was created.</p>
</section>
</section>
</section>
</section>
<section id="example">
<h3><a class="toc-backref" href="#example">Example</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">version</span> <span class="o">=</span> <span class="mi">1</span>

<span class="p">[</span><span class="n">tool</span><span class="p">]</span>
<span class="c1"># Tool-specific table ala PEP 518&#39;s `[tool]` table.</span>

<span class="p">[</span><span class="n">metadata</span><span class="p">]</span>
<span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;python_version&gt;=&#39;3.6&#39;&quot;</span>

<span class="n">needs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mousebender&quot;</span><span class="p">]</span>

<span class="p">[[</span><span class="n">package</span><span class="o">.</span><span class="n">attrs</span><span class="p">]]</span>
<span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;21.2.0&quot;</span>
<span class="n">needed</span><span class="o">-</span><span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mousebender&quot;</span><span class="p">]</span>

<span class="p">[[</span><span class="n">package</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">code</span><span class="p">]]</span>
<span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;wheel&quot;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://files.pythonhosted.org/packages/20/a9/ba6f1cd1a1517ff022b35acd6a7e4246371dfab08b8e42b829b6d07913cc/attrs-21.2.0-py2.py3-none-any.whl&quot;</span>
<span class="nb">hash</span><span class="o">-</span><span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;sha256&quot;</span>
<span class="nb">hash</span><span class="o">-</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;149e90d6d8ac20db7a955ad60cf0e6881a3f20d37096140088356da6c716b0b1&quot;</span>

<span class="p">[[</span><span class="n">package</span><span class="o">.</span><span class="n">mousebender</span><span class="p">]]</span>
<span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;2.0.0&quot;</span>
<span class="n">needs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;attrs&gt;=19.3&quot;</span><span class="p">,</span> <span class="s2">&quot;packaging&gt;=20.3&quot;</span><span class="p">]</span>

<span class="p">[[</span><span class="n">package</span><span class="o">.</span><span class="n">mousebender</span><span class="o">.</span><span class="n">code</span><span class="p">]]</span>
<span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;sdist&quot;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://files.pythonhosted.org/packages/35/bc/db77f8ca1ccf85f5c3324e4f62fc74bf6f6c098da11d7c30ef6d0f43e859/mousebender-2.0.0.tar.gz&quot;</span>
<span class="nb">hash</span><span class="o">-</span><span class="n">algorithm</span> <span class="o">=</span> <span class="s2">&quot;sha256&quot;</span>
<span class="nb">hash</span><span class="o">-</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;c5953026378e5dcc7090596dfcbf73aa5a9786842357273b1df974ebd79bd760&quot;</span>

<span class="p">[[</span><span class="n">package</span><span class="o">.</span><span class="n">mousebender</span><span class="o">.</span><span class="n">code</span><span class="p">]]</span>
<span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;wheel&quot;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://files.pythonhosted.org/packages/f4/b3/f6fdbff6395e9b77b5619160180489410fb2f42f41272994353e7ecf5bdf/mousebender-2.0.0-py3-none-any.whl&quot;</span>
<span class="nb">hash</span><span class="o">-</span><span class="n">algorithm</span> <span class="o">=</span> <span class="s2">&quot;sha256&quot;</span>
<span class="nb">hash</span><span class="o">-</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;a6f9adfbd17bfb0e6bb5de9a27083e01dfb86ed9c3861e04143d9fd6db373f7c&quot;</span>

<span class="p">[[</span><span class="n">package</span><span class="o">.</span><span class="n">packaging</span><span class="p">]]</span>
<span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;20.9&quot;</span>
<span class="n">needs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pyparsing&gt;=2.0.2&quot;</span><span class="p">]</span>
<span class="n">needed</span><span class="o">-</span><span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mousebender&quot;</span><span class="p">]</span>

<span class="p">[[</span><span class="n">package</span><span class="o">.</span><span class="n">packaging</span><span class="o">.</span><span class="n">code</span><span class="p">]]</span>
<span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;git&quot;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/pypa/packaging.git&quot;</span>
<span class="n">commit</span> <span class="o">=</span> <span class="s2">&quot;53fd698b1620aca027324001bf53c8ffda0c17d1&quot;</span>

<span class="p">[[</span><span class="n">package</span><span class="o">.</span><span class="n">pyparsing</span><span class="p">]]</span>
<span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;2.4.7&quot;</span>
<span class="n">needed</span><span class="o">-</span><span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;packaging&quot;</span><span class="p">]</span>

<span class="p">[[</span><span class="n">package</span><span class="o">.</span><span class="n">pyparsing</span><span class="o">.</span><span class="n">code</span><span class="p">]]</span>
<span class="nb">type</span><span class="o">=</span><span class="s2">&quot;wheel&quot;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://files.pythonhosted.org/packages/8a/bb/488841f56197b13700afd5658fc279a2025a39e22449b7cf29864669b15d/pyparsing-2.4.7-py2.py3-none-any.whl&quot;</span>
<span class="nb">hash</span><span class="o">-</span><span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;sha256&quot;</span>
<span class="nb">hash</span><span class="o">-</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;ef9d7589ef3c200abe66653d3f1ab1033c3c419ae9b9bdb1240a85b024efc88b&quot;</span>
<span class="n">interpreter</span><span class="o">-</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;py2.py3&quot;</span>
<span class="n">abi</span><span class="o">-</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
<span class="n">platform</span><span class="o">-</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;any&quot;</span>
</pre></div>
</div>
</section>
<section id="installer-expectations">
<h3><a class="toc-backref" href="#installer-expectations">Installer Expectations</a></h3>
<p>Installers MUST implement the
<a class="reference external" href="https://packaging.python.org/specifications/direct-url/">direct URL origin of installed distributions spec</a> <a class="footnote-reference brackets" href="#id14" id="id15">6</a> as all packages
installed from a lock file inherently originate from a URL and not a
search of an index by package name and version.</p>
<p>Installers MUST error out if they encounter something they are unable
to handle (e.g. lack of environment marker support).</p>
<section id="example-flow">
<h4><a class="toc-backref" href="#example-flow">Example Flow</a></h4>
<ol class="arabic simple">
<li>Have the user specify which lock file they would like to use in
<code class="docutils literal notranslate"><span class="pre">pyproject-lock.d</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">dev</span></code>, <code class="docutils literal notranslate"><span class="pre">prod</span></code>)</li>
<li>Check if the environment supports what is specified in
<code class="docutils literal notranslate"><span class="pre">metadata.tags</span></code>; error out if it doesn’t</li>
<li>Check if the environment supports what is specified in
<code class="docutils literal notranslate"><span class="pre">metadata.marker</span></code>; error out if it doesn’t</li>
<li>Gather the list of package names from <code class="docutils literal notranslate"><span class="pre">metadata.needs</span></code>, and for
each listed package …<ol class="arabic simple">
<li>Resolve any markers to find the appropriate package to install</li>
<li>Find the most appropriate code to install for the package</li>
<li>Repeat the above steps for packages listed in the <code class="docutils literal notranslate"><span class="pre">needs</span></code> key
for each package found to install</li>
</ol>
</li>
<li>For each project collected to install …<ol class="arabic simple">
<li>Gather the specified code for the package</li>
<li>Verify hashes of code</li>
<li>Install the packages (if necessary)</li>
</ol>
</li>
</ol>
</section>
</section>
</section>
<section id="backwards-compatibility">
<h2><a class="toc-backref" href="#backwards-compatibility">Backwards Compatibility</a></h2>
<p>As there is no pre-existing specification regarding lock files, there
are no explicit backwards compatibility concerns.</p>
<p>As for pre-existing tools that have their own lock file, some updating
will be required. Most document the lock file name, but not its
contents, in which case the file name of the lock file(s) is the
important part. For projects which do not commit their lock file to
version control, they will need to update the equivalent of their
<code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file. For projects that do commit their lock file to
version control, what file(s) get committed will need an update.</p>
<p>For projects which do document their lock file format like <a class="reference external" href="https://pypi.org/project/pipenv/">pipenv</a> <a class="footnote-reference brackets" href="#id29" id="id32">12</a>,
they will very likely need a new major version release.</p>
<p>Specifically for <a class="reference external" href="https://pypi.org/project/poetry/">Poetry</a> <a class="footnote-reference brackets" href="#id40" id="id43">14</a>, it has an
<a class="reference external" href="https://python-poetry.org/docs/cli/#export">export command</a> which
should allow Poetry to support this lock file format even if the
project chose not to adopt this PEP as Poetry’s primary lock file
format.</p>
</section>
<section id="security-implications">
<h2><a class="toc-backref" href="#security-implications">Security Implications</a></h2>
<p>A lock file should not introduce security issues but instead help
solve them. By requiring the recording of hashes of code, a lock file
is able to help prevent tampering with code since the hash details
were recorded. A lock file also helps prevent unexpected package
updates being installed which may be malicious.</p>
</section>
<section id="how-to-teach-this">
<h2><a class="toc-backref" href="#how-to-teach-this">How to Teach This</a></h2>
<p>Teaching of this PEP will very much be dependent on the lockers and
installers being used for day-to-day use. Conceptually, though, users
could be taught that the <code class="docutils literal notranslate"><span class="pre">pyproject-lock.d</span></code> directory contains files
which specify what should be installed for a project to work. The
benefits of consistency and security should be emphasized to help
users realize why they should care about lock files.</p>
</section>
<section id="reference-implementation">
<h2><a class="toc-backref" href="#reference-implementation">Reference Implementation</a></h2>
<p>No proof-of-concept or reference implementation currently exists.</p>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#rejected-ideas">Rejected Ideas</a></h2>
<section id="file-formats-other-than-toml">
<h3><a class="toc-backref" href="#file-formats-other-than-toml">File Formats Other Than TOML</a></h3>
<p><a class="reference external" href="https://www.json.org/">JSON</a> <a class="footnote-reference brackets" href="#id19" id="id20">8</a> was briefly considered, but due to:</p>
<ol class="arabic simple">
<li>TOML already being used for <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code></li>
<li>TOML being more human-readable</li>
<li>TOML leading to better diffs</li>
</ol>
<p>the decision was made to go with TOML. There was some concern over
Python’s standard library lacking a TOML parser, but most packaging
tools already use a TOML parser thanks to <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> so this
issue did not seem to be a showstopper. Some have also argued against
this concern in the past by the fact that if packaging tools abhor
installing dependencies and feel they can’t vendor a package then the
packaging ecosystem has much bigger issues to rectify than needing to
depend on a third-party TOML parser.</p>
</section>
<section id="alternative-name-to-pyproject-lock-d">
<h3><a class="toc-backref" href="#alternative-name-to-pyproject-lock-d">Alternative Name to <code class="docutils literal notranslate"><span class="pre">pyproject-lock.d</span></code></a></h3>
<p>The name <code class="docutils literal notranslate"><span class="pre">__lockfile__</span></code> was briefly considered, but the directory
would not sort next to <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> in instances where files
and directories were sorted together in lexicographic order. The
current naming is also more obvious in terms of its relationship
to <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>.</p>
</section>
<section id="supporting-a-single-lock-file">
<h3><a class="toc-backref" href="#supporting-a-single-lock-file">Supporting a Single Lock File</a></h3>
<p>At one point the idea of not using a directory of lock files but a
single lock file which contained all possible lock information was
considered. But it quickly became apparent that trying to devise a
data format which could encompass both a lock file format which could
support multiple environments as well as strict lock outcomes for
reproducible builds would become quite complex and cumbersome.</p>
<p>The idea of supporting a directory of lock files as well as a single
lock file named <code class="docutils literal notranslate"><span class="pre">pyproject-lock.toml</span></code> was also considered. But any
possible simplicity from skipping the directory in the case of a
single lock file seemed unnecessary. Trying to define appropriate
logic for what should be the <code class="docutils literal notranslate"><span class="pre">pyproject-lock.toml</span></code> file and what
should go into <code class="docutils literal notranslate"><span class="pre">pyproject-lock.d</span></code> seemed unnecessarily complicated.</p>
</section>
<section id="using-a-flat-list-instead-of-a-dependency-graph">
<h3><a class="toc-backref" href="#using-a-flat-list-instead-of-a-dependency-graph">Using a Flat List Instead of a Dependency Graph</a></h3>
<p>The first version of this PEP proposed that the lock file have no
concept of a dependency graph. Instead, the lock file would list
exactly what should be installed for a specific platform such that
installers did not have to make any decisions about <em>what</em> to install,
only validating that the lock file would work for the target platform.</p>
<p>This idea was eventually rejected due to the number of combinations
of potential <a class="reference external" href="../pep-0508">PEP 508</a> environment markers. The decision was made that
trying to have lockers generate all possible combinations when a
project wants to be cross-platform would be too much.</p>
</section>
<section id="being-concerned-about-different-dependencies-per-wheel-file-for-a-project">
<h3><a class="toc-backref" href="#being-concerned-about-different-dependencies-per-wheel-file-for-a-project">Being Concerned About Different Dependencies Per Wheel File For a Project</a></h3>
<p>It is technically possible for a project to specify different
dependencies between its various wheel files. Taking that into
consideration would then require the lock file to operate not
per-project but per-file. Luckily, specifying different dependencies
in this way is very rare and frowned upon and so it was deemed not
worth supporting.</p>
</section>
<section id="use-wheel-tags-in-the-file-name">
<h3><a class="toc-backref" href="#use-wheel-tags-in-the-file-name">Use Wheel Tags in the File Name</a></h3>
<p>Instead of having the <code class="docutils literal notranslate"><span class="pre">metadata.tags</span></code> field there was a suggestion
of encoding the tags into the file name. But due to the addition of
the <code class="docutils literal notranslate"><span class="pre">metadata.marker</span></code> field and what to do when no tags were needed,
the idea was dropped.</p>
</section>
<section id="using-semantic-versioning-for-version">
<h3><a class="toc-backref" href="#using-semantic-versioning-for-version">Using Semantic Versioning for <code class="docutils literal notranslate"><span class="pre">version</span></code></a></h3>
<p>Instead of a monotonically increasing integer, using a float was
considered to attempt to convey semantic versioning. In the end,
though, it was deemed more hassle than it was worth as adding a new
key would likely constitute a “major” version change (only if the
key was entirely optional would it be considered “minor”), and
experience with the <a class="reference external" href="https://packaging.python.org/specifications/core-metadata/">core metadata spec</a> <a class="footnote-reference brackets" href="#id4" id="id5">2</a> suggests there’s a bigger
chance parsing will be relaxed and made more strict which is also a
“major” change. As such, the simplicity of using an integer made
sense.</p>
</section>
<section id="alternative-names-for-needs">
<h3><a class="toc-backref" href="#alternative-names-for-needs">Alternative Names for <code class="docutils literal notranslate"><span class="pre">needs</span></code></a></h3>
<p>Some other names for what became <code class="docutils literal notranslate"><span class="pre">needs</span></code> were <code class="docutils literal notranslate"><span class="pre">installs</span></code> and
<code class="docutils literal notranslate"><span class="pre">dependencies</span></code>. In the end a Python beginner was asked which term
they preferred and they found <code class="docutils literal notranslate"><span class="pre">needs</span></code> clearer. Since there wasn’t
any reason to disagree with that, the decision was to go with
<code class="docutils literal notranslate"><span class="pre">needs</span></code>.</p>
</section>
<section id="alternative-names-for-needed-by">
<h3><a class="toc-backref" href="#alternative-names-for-needed-by">Alternative Names for <code class="docutils literal notranslate"><span class="pre">needed-by</span></code></a></h3>
<p>Other names that were considered were <code class="docutils literal notranslate"><span class="pre">dependents</span></code>, <code class="docutils literal notranslate"><span class="pre">depended-by</span></code>,
, <code class="docutils literal notranslate"><span class="pre">supports</span></code> and <code class="docutils literal notranslate"><span class="pre">required-by</span></code>. In the end, <code class="docutils literal notranslate"><span class="pre">needed-by</span></code> made
sense and tied into <code class="docutils literal notranslate"><span class="pre">needs</span></code>.</p>
</section>
<section id="only-allowing-a-single-code-location-for-a-project">
<h3><a class="toc-backref" href="#only-allowing-a-single-code-location-for-a-project">Only Allowing a Single Code Location For a Project</a></h3>
<p>While reproducibility is serviced better by only allowing a single
code location, it limits usability for situations where one wants to
support multiple platforms with a single lock file (which the community
has shown is desired).</p>
</section>
<section id="support-for-branches-and-tags-for-git">
<h3><a class="toc-backref" href="#support-for-branches-and-tags-for-git">Support for Branches and Tags for Git</a></h3>
<p>Due to the <a class="reference external" href="https://packaging.python.org/specifications/direct-url/">direct URL origin of installed distributions spec</a> <a class="footnote-reference brackets" href="#id14" id="id16">6</a>
supporting the specification of branches and tags, it was suggested
that lock files support the same thing. But because branches and tags
can change what commit they point to between locking and installation,
that was viewed as a security concern (Git commit IDs are hashes of
metadata and thus are viewed as immutable).</p>
</section>
<section id="accepting-pep-650">
<h3><a class="toc-backref" href="#accepting-pep-650">Accepting PEP 650</a></h3>
<p><a class="reference external" href="../pep-0650">PEP 650</a> was an earlier attempt at trying to tackle this problem by
specifying an API for installers instead of standardizing on a lock file
format (ala <a class="reference external" href="../pep-0517">PEP 517</a>). The
<a class="reference external" href="https://discuss.python.org/t/pep-650-specifying-installer-requirements-for-python-projects/6657/">initial response</a>
to <a class="reference external" href="../pep-0650">PEP 650</a> could be considered mild/lukewarm. People seemed to be
consistently confused over which tools should provide what functionality
to implement the PEP. It also potentially incurred more overhead as
it would require executing Python APIs to perform any actions involving
packaging.</p>
<p>This PEP chose to standardize around an artifact instead of an API
(ala <a class="reference external" href="../pep-0621">PEP 621</a>). This would allow for more tool integrations as it
removes the need to specifically use Python to do things such as
create a lock file, update it, or even install packages listed in
a lock file. It also allows for easier introspection by forcing
dependency graph details to be written in a human-readable format.
It also allows for easier sharing of knowledge by standardizing what
people need to know more (e.g. tutorials become more portable between
tools when it comes to understanding the artifact they produce). It’s
also simply the approach other language communities have taken and seem
to be happy with.</p>
</section>
</section>
<section id="open-issues">
<h2><a class="toc-backref" href="#open-issues">Open Issues</a></h2>
<section id="allow-for-tool-specific-type-values">
<h3><a class="toc-backref" href="#allow-for-tool-specific-type-values">Allow for Tool-Specific <code class="docutils literal notranslate"><span class="pre">type</span></code> Values</a></h3>
<p>It has been suggested to allow for custom <code class="docutils literal notranslate"><span class="pre">type</span></code> values in the
<code class="docutils literal notranslate"><span class="pre">code</span></code> table. They would be prefixed with <code class="docutils literal notranslate"><span class="pre">x-</span></code> and followed by
the tool’s name and then the type, i.e. <code class="docutils literal notranslate"><span class="pre">x-&lt;tool&gt;-&lt;type&gt;</span></code>. This
would provide enough flexibility for things such as other version
control systems, innovative container formats, etc. to be officially
usable in a lock file.</p>
</section>
<section id="support-variable-expansion-in-the-url-field">
<h3><a class="toc-backref" href="#support-variable-expansion-in-the-url-field">Support Variable Expansion in the <code class="docutils literal notranslate"><span class="pre">url</span></code> field</a></h3>
<p>This could include predefined variables like <code class="docutils literal notranslate"><span class="pre">PROJECT_ROOT</span></code> for the
directory containing <code class="docutils literal notranslate"><span class="pre">pyproject-lock.d</span></code> so URLs to local directories
and files could be relative to the project itself.</p>
<p>Environment variables could be supported to avoid hardcoding things
such as user credentials for Git.</p>
</section>
<section id="don-t-require-lock-files-be-in-a-pyproject-lock-d-directory">
<h3><a class="toc-backref" href="#don-t-require-lock-files-be-in-a-pyproject-lock-d-directory">Don’t Require Lock Files Be in a <code class="docutils literal notranslate"><span class="pre">pyproject-lock.d</span></code> directory</a></h3>
<p>It has been suggested that since installers may very well allow users
to specify the path to a lock file that having this PEP say that
“MUST be kept in a directory named <code class="docutils literal notranslate"><span class="pre">pyproject-lock.d</span></code>” is pointless
as it is bound to be broken. As such, the suggestion is to change
“MUST” to “SHOULD”.</p>
</section>
<section id="record-the-date-of-when-the-lock-file-was-generated">
<h3><a class="toc-backref" href="#record-the-date-of-when-the-lock-file-was-generated">Record the Date of When the Lock File was Generated</a></h3>
<p>Since the modification date is not guaranteed to match when the lock
file was generated, it has been suggested to record the date as part
of the file’s metadata. The question, though, is how useful is this
information and can lockers that care put it into their <code class="docutils literal notranslate"><span class="pre">[tool]</span></code>
table instead of mandating it be set?</p>
</section>
<section id="locking-build-dependencies">
<h3><a class="toc-backref" href="#locking-build-dependencies">Locking Build Dependencies</a></h3>
<p>Thanks to <a class="reference external" href="../pep-0518">PEP 518</a>, source trees and sdists can specify what build
tools must be installed in order to build a wheel (or sdist in the
case of a source tree). It has been suggested that the lock file also
record such packages so to increase how reproducible an installation
can be.</p>
<p>There is nothing currently in this PEP, though, that prohibits a
locker from recording build tools thanks to <code class="docutils literal notranslate"><span class="pre">metadata.needs</span></code> acting
as the entry point for calculating what to install. There is also a
cost in downloading all potential sdists and source trees, reading
their <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> files, and then calculating their build
dependencies for locking purposes for which not everyone will want to
pay the cost for.</p>
</section>
<section id="recording-the-requires-dist-input-to-the-locker-s-resolver">
<h3><a class="toc-backref" href="#recording-the-requires-dist-input-to-the-locker-s-resolver">Recording the <code class="docutils literal notranslate"><span class="pre">Requires-Dist</span></code> Input to the Locker’s Resolver</a></h3>
<p>While the <code class="docutils literal notranslate"><span class="pre">needs</span></code> key allows for recording dependency specifiers,
this PEP does not currently require the <code class="docutils literal notranslate"><span class="pre">needs</span></code> key to record the
<strong>exact</strong> <code class="docutils literal notranslate"><span class="pre">Requires-Dist</span></code> metadata that was used to calculate the
lock file. It has been suggested that recording the inputs would help
in auditing the outcome of the lock file.</p>
<p>If this were to be done, it would be an key named <code class="docutils literal notranslate"><span class="pre">requested</span></code> which
lived along side <code class="docutils literal notranslate"><span class="pre">needs</span></code> and would only be specified if it would
differ from what is specified in <code class="docutils literal notranslate"><span class="pre">needs</span></code>.</p>
</section>
<section id="providing-marker-and-tags-per-package">
<h3><a class="toc-backref" href="#providing-marker-and-tags-per-package">Providing <code class="docutils literal notranslate"><span class="pre">marker</span></code> and <code class="docutils literal notranslate"><span class="pre">tags</span></code> per Package</a></h3>
<p>It has been suggested to allow for the <code class="docutils literal notranslate"><span class="pre">marker</span></code> and <code class="docutils literal notranslate"><span class="pre">tags</span></code> keys
as found in the <code class="docutils literal notranslate"><span class="pre">[metadata]</span></code> table in <code class="docutils literal notranslate"><span class="pre">[package]</span></code> tables as well.
This would allow lockers to specify when a version of a package
should be considered. This also has the potential for lowering
computational costs for installers by assisting them in knowing when
to remove a package version from consideration.</p>
<p>This does, though, somewhat duplicate environment markers being kept
in the <code class="docutils literal notranslate"><span class="pre">needs</span></code> array.</p>
</section>
</section>
<section id="acknowledgments">
<h2><a class="toc-backref" href="#acknowledgments">Acknowledgments</a></h2>
<p>Thanks to Frost Ming of <a class="reference external" href="https://pypi.org/project/pdm/">PDM</a> <a class="footnote-reference brackets" href="#id23" id="id26">10</a> and Sébastien Eustace of <a class="reference external" href="https://pypi.org/project/poetry/">Poetry</a> <a class="footnote-reference brackets" href="#id40" id="id44">14</a> for
providing input around dynamic install-time resolution of <a class="reference external" href="../pep-0508">PEP 508</a>
requirements.</p>
<p>Thanks to Kushal Das for making sure reproducible builds stayed a
concern for this PEP.</p>
<p>Thanks to Andrea McInnes for settling the bikeshedding and choosing
the paint colour of <code class="docutils literal notranslate"><span class="pre">needs</span></code>.</p>
</section>
<section id="id1">
<h2><a class="toc-backref" href="#id1">References</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id3">1</a></span></dt>
<dd><a class="reference external" href="https://packaging.python.org/specifications/declaring-build-dependencies/">https://packaging.python.org/specifications/declaring-build-dependencies/</a></dd>
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id5">2</a></span></dt>
<dd><a class="reference external" href="https://packaging.python.org/specifications/core-metadata/">https://packaging.python.org/specifications/core-metadata/</a></dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id7">3</a></span></dt>
<dd><a class="reference external" href="https://dart.dev/">https://dart.dev/</a></dd>
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id9">4</a></span></dt>
<dd><a class="reference external" href="https://dependabot.com/">https://dependabot.com/</a></dd>
<dt class="label" id="id10"><span class="brackets">5</span><span class='fn-backref''><em> (<a href='#id11'>1</a>, <a href='#id12'>2</a>, <a href='#id13'>3</a>) </em></span></dt>
<dd><a class="reference external" href="https://packaging.python.org/specifications/dependency-specifiers/">https://packaging.python.org/specifications/dependency-specifiers/</a></dd>
<dt class="label" id="id14"><span class="brackets">6</span><span class='fn-backref''><em> (<a href='#id15'>1</a>, <a href='#id16'>2</a>) </em></span></dt>
<dd><a class="reference external" href="https://packaging.python.org/specifications/direct-url/">https://packaging.python.org/specifications/direct-url/</a></dd>
<dt class="label" id="id17"><span class="brackets"><a class="fn-backref" href="#id18">7</a></span></dt>
<dd><a class="reference external" href="https://git-scm.com/">https://git-scm.com/</a></dd>
<dt class="label" id="id19"><span class="brackets"><a class="fn-backref" href="#id20">8</a></span></dt>
<dd><a class="reference external" href="https://www.json.org/">https://www.json.org/</a></dd>
<dt class="label" id="id21"><span class="brackets"><a class="fn-backref" href="#id22">9</a></span></dt>
<dd><a class="reference external" href="https://www.npmjs.com/">https://www.npmjs.com/</a></dd>
<dt class="label" id="id23"><span class="brackets">10</span><span class='fn-backref''><em> (<a href='#id24'>1</a>, <a href='#id25'>2</a>, <a href='#id26'>3</a>) </em></span></dt>
<dd><a class="reference external" href="https://pypi.org/project/pdm/">https://pypi.org/project/pdm/</a></dd>
<dt class="label" id="id27"><span class="brackets"><a class="fn-backref" href="#id28">11</a></span></dt>
<dd><a class="reference external" href="https://pypi.org/project/pip-tools/">https://pypi.org/project/pip-tools/</a></dd>
<dt class="label" id="id29"><span class="brackets">12</span><span class='fn-backref''><em> (<a href='#id30'>1</a>, <a href='#id31'>2</a>, <a href='#id32'>3</a>) </em></span></dt>
<dd><a class="reference external" href="https://pypi.org/project/pipenv/">https://pypi.org/project/pipenv/</a></dd>
<dt class="label" id="id33"><span class="brackets">13</span><span class='fn-backref''><em> (<a href='#id34'>1</a>, <a href='#id35'>2</a>, <a href='#id36'>3</a>, <a href='#id37'>4</a>, <a href='#id38'>5</a>, <a href='#id39'>6</a>) </em></span></dt>
<dd><a class="reference external" href="https://packaging.python.org/specifications/platform-compatibility-tags/">https://packaging.python.org/specifications/platform-compatibility-tags/</a></dd>
<dt class="label" id="id40"><span class="brackets">14</span><span class='fn-backref''><em> (<a href='#id41'>1</a>, <a href='#id42'>2</a>, <a href='#id43'>3</a>, <a href='#id44'>4</a>) </em></span></dt>
<dd><a class="reference external" href="https://pypi.org/project/poetry/">https://pypi.org/project/poetry/</a></dd>
<dt class="label" id="id45"><span class="brackets"><a class="fn-backref" href="#id46">15</a></span></dt>
<dd><a class="reference external" href="https://pypi.org/project/pyflow/">https://pypi.org/project/pyflow/</a></dd>
<dt class="label" id="id47"><span class="brackets"><a class="fn-backref" href="#id48">16</a></span></dt>
<dd><a class="reference external" href="https://pyup.io/">https://pyup.io/</a></dd>
<dt class="label" id="id49"><span class="brackets"><a class="fn-backref" href="#id50">17</a></span></dt>
<dd><a class="reference external" href="https://www.rust-lang.org/">https://www.rust-lang.org/</a></dd>
<dt class="label" id="id51"><span class="brackets"><a class="fn-backref" href="#id52">18</a></span></dt>
<dd><a class="reference external" href="https://securedrop.org/">https://securedrop.org/</a></dd>
<dt class="label" id="id53"><span class="brackets">19</span><span class='fn-backref''><em> (<a href='#id54'>1</a>, <a href='#id55'>2</a>) </em></span></dt>
<dd><a class="reference external" href="https://packaging.python.org/specifications/simple-repository-api/">https://packaging.python.org/specifications/simple-repository-api/</a></dd>
<dt class="label" id="id56"><span class="brackets">20</span><span class='fn-backref''><em> (<a href='#id57'>1</a>, <a href='#id58'>2</a>, <a href='#id59'>3</a>) </em></span></dt>
<dd><a class="reference external" href="https://packaging.python.org/specifications/source-distribution-format/">https://packaging.python.org/specifications/source-distribution-format/</a></dd>
<dt class="label" id="id60"><span class="brackets"><a class="fn-backref" href="#id61">21</a></span></dt>
<dd><a class="reference external" href="https://toml.io">https://toml.io</a></dd>
<dt class="label" id="id62"><span class="brackets">22</span><span class='fn-backref''><em> (<a href='#id63'>1</a>, <a href='#id64'>2</a>) </em></span></dt>
<dd><a class="reference external" href="https://packaging.python.org/specifications/version-specifiers/">https://packaging.python.org/specifications/version-specifiers/</a></dd>
<dt class="label" id="id65"><span class="brackets"><a class="fn-backref" href="#id66">23</a></span></dt>
<dd><a class="reference external" href="https://packaging.python.org/specifications/binary-distribution-format/">https://packaging.python.org/specifications/binary-distribution-format/</a></dd>
</dl>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright">Copyright</a></h2>
<p>This document is placed in the public domain or under the
CC0-1.0-Universal license, whichever is more permissive.</p>
</section>
</section>
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/master/pep-0665.rst">https://github.com/python/peps/blob/master/pep-0665.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/master/pep-0665.rst">2021-09-17 18:18:24 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#">PEP 665 – Specifying Installation Requirements for Python Projects</a><ul>
<li><a class="reference internal" href="#contents">Contents</a></li>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a><ul>
<li><a class="reference internal" href="#providers">Providers</a><ul>
<li><a class="reference internal" href="#platform-infrastructure-providers">Platform/Infrastructure Providers</a></li>
<li><a class="reference internal" href="#ide-providers">IDE Providers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#developers">Developers</a><ul>
<li><a class="reference internal" href="#developers-using-paas-iaas-providers">Developers using PaaS &amp; IaaS providers</a></li>
<li><a class="reference internal" href="#developers-using-ides">Developers using IDEs</a></li>
<li><a class="reference internal" href="#developers-working-with-other-developers">Developers working with other developers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upgraders-package-infrastructure-providers">Upgraders &amp; Package Infrastructure Providers</a></li>
<li><a class="reference internal" href="#open-source-community">Open Source Community</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rationale">Rationale</a><ul>
<li><a class="reference internal" href="#goals">Goals</a></li>
<li><a class="reference internal" href="#non-goals">Non-Goals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#details">Details</a><ul>
<li><a class="reference internal" href="#version"><code class="docutils literal notranslate"><span class="pre">version</span></code></a></li>
<li><a class="reference internal" href="#tool"><code class="docutils literal notranslate"><span class="pre">[tool]</span></code></a></li>
<li><a class="reference internal" href="#metadata"><code class="docutils literal notranslate"><span class="pre">[metadata]</span></code></a><ul>
<li><a class="reference internal" href="#metadata-marker"><code class="docutils literal notranslate"><span class="pre">metadata.marker</span></code></a></li>
<li><a class="reference internal" href="#metadata-tags"><code class="docutils literal notranslate"><span class="pre">metadata.tags</span></code></a></li>
<li><a class="reference internal" href="#metadata-needs"><code class="docutils literal notranslate"><span class="pre">metadata.needs</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#package"><code class="docutils literal notranslate"><span class="pre">[package]</span></code></a><ul>
<li><a class="reference internal" href="#package-name-version"><code class="docutils literal notranslate"><span class="pre">package.&lt;name&gt;.version</span></code></a></li>
<li><a class="reference internal" href="#package-name-needs"><code class="docutils literal notranslate"><span class="pre">package.&lt;name&gt;.needs</span></code></a></li>
<li><a class="reference internal" href="#package-name-needed-by"><code class="docutils literal notranslate"><span class="pre">package.&lt;name&gt;.needed-by</span></code></a></li>
<li><a class="reference internal" href="#package-name-code"><code class="docutils literal notranslate"><span class="pre">package.&lt;name&gt;.code</span></code></a><ul>
<li><a class="reference internal" href="#type-wheel"><code class="docutils literal notranslate"><span class="pre">type=&quot;wheel&quot;</span></code></a></li>
<li><a class="reference internal" href="#type-sdist"><code class="docutils literal notranslate"><span class="pre">type=&quot;sdist&quot;</span></code></a></li>
<li><a class="reference internal" href="#type-git"><code class="docutils literal notranslate"><span class="pre">type=&quot;git&quot;</span></code></a></li>
<li><a class="reference internal" href="#type-source-tree"><code class="docutils literal notranslate"><span class="pre">type=&quot;source</span> <span class="pre">tree&quot;</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#installer-expectations">Installer Expectations</a><ul>
<li><a class="reference internal" href="#example-flow">Example Flow</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#security-implications">Security Implications</a></li>
<li><a class="reference internal" href="#how-to-teach-this">How to Teach This</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a><ul>
<li><a class="reference internal" href="#file-formats-other-than-toml">File Formats Other Than TOML</a></li>
<li><a class="reference internal" href="#alternative-name-to-pyproject-lock-d">Alternative Name to <code class="docutils literal notranslate"><span class="pre">pyproject-lock.d</span></code></a></li>
<li><a class="reference internal" href="#supporting-a-single-lock-file">Supporting a Single Lock File</a></li>
<li><a class="reference internal" href="#using-a-flat-list-instead-of-a-dependency-graph">Using a Flat List Instead of a Dependency Graph</a></li>
<li><a class="reference internal" href="#being-concerned-about-different-dependencies-per-wheel-file-for-a-project">Being Concerned About Different Dependencies Per Wheel File For a Project</a></li>
<li><a class="reference internal" href="#use-wheel-tags-in-the-file-name">Use Wheel Tags in the File Name</a></li>
<li><a class="reference internal" href="#using-semantic-versioning-for-version">Using Semantic Versioning for <code class="docutils literal notranslate"><span class="pre">version</span></code></a></li>
<li><a class="reference internal" href="#alternative-names-for-needs">Alternative Names for <code class="docutils literal notranslate"><span class="pre">needs</span></code></a></li>
<li><a class="reference internal" href="#alternative-names-for-needed-by">Alternative Names for <code class="docutils literal notranslate"><span class="pre">needed-by</span></code></a></li>
<li><a class="reference internal" href="#only-allowing-a-single-code-location-for-a-project">Only Allowing a Single Code Location For a Project</a></li>
<li><a class="reference internal" href="#support-for-branches-and-tags-for-git">Support for Branches and Tags for Git</a></li>
<li><a class="reference internal" href="#accepting-pep-650">Accepting PEP 650</a></li>
</ul>
</li>
<li><a class="reference internal" href="#open-issues">Open Issues</a><ul>
<li><a class="reference internal" href="#allow-for-tool-specific-type-values">Allow for Tool-Specific <code class="docutils literal notranslate"><span class="pre">type</span></code> Values</a></li>
<li><a class="reference internal" href="#support-variable-expansion-in-the-url-field">Support Variable Expansion in the <code class="docutils literal notranslate"><span class="pre">url</span></code> field</a></li>
<li><a class="reference internal" href="#don-t-require-lock-files-be-in-a-pyproject-lock-d-directory">Don’t Require Lock Files Be in a <code class="docutils literal notranslate"><span class="pre">pyproject-lock.d</span></code> directory</a></li>
<li><a class="reference internal" href="#record-the-date-of-when-the-lock-file-was-generated">Record the Date of When the Lock File was Generated</a></li>
<li><a class="reference internal" href="#locking-build-dependencies">Locking Build Dependencies</a></li>
<li><a class="reference internal" href="#recording-the-requires-dist-input-to-the-locker-s-resolver">Recording the <code class="docutils literal notranslate"><span class="pre">Requires-Dist</span></code> Input to the Locker’s Resolver</a></li>
<li><a class="reference internal" href="#providing-marker-and-tags-per-package">Providing <code class="docutils literal notranslate"><span class="pre">marker</span></code> and <code class="docutils literal notranslate"><span class="pre">tags</span></code> per Package</a></li>
</ul>
</li>
<li><a class="reference internal" href="#acknowledgments">Acknowledgments</a></li>
<li><a class="reference internal" href="#id1">References</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</li>
</ul>

            <br />
            <strong><a href="https://github.com/python/peps/blob/master/pep-0665.rst">Page Source (GitHub)</a></strong>
        </nav>
    </section>
    <script src="../_static/doctools.js"></script>
</body>
</html>